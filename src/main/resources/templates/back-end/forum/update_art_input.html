<!DOCTYPE html>
<html lang="ZH-Hant" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章資料修改 | 後台 | 島遊kha</title>
    <th:block th:replace="~{/navBackTemplate :: headResources}"></th:block>
    <!--後台CSS-->
    <link rel="stylesheet" th:href="@{/css/light.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link th:href="@{/vendors/quillEditor/quill.snow.css}" rel="stylesheet">

    <style>
        .input-readonly[readonly] {
            background-color: var(--md-sys-color-surface-container); /* 背景微灰 */
            color: var(--md-sys-color-outline); /* 字色淡灰 */
            cursor: not-allowed; /* 滑鼠禁止 */
            border: 1px solid var(--md-sys-color-outline-variant); /* 邊框淡灰 */
            padding: 10px;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .article-edit-form {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--md-sys-color-surface-container-lowest);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .article-edit-form .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }

        .article-edit-form .form-group label {
            font-weight: 500;
            color: var(--md-sys-color-on-surface-variant);
            margin-bottom: 8px;
            font-size: 15px;
        }

        .article-edit-form .form-group input,
        .article-edit-form .form-group select {
            padding: 12px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 6px;
            font-size: 16px;
            /*background-color: var(--md-sys-color-surface-container-highest);*/
            color: var(--md-sys-color-on-surface);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            box-sizing: border-box;
        }

        .article-edit-form .form-group input:focus,
        .article-edit-form .form-group select:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px var(--md-sys-color-primary-container);
            outline: none;
        }

        .article-edit-form .form-group .error {
            color: var(--md-sys-color-error);
            font-size: 14px;
            margin-top: 5px;
        }

        /* Quill 編輯器包裝區塊 */
        .quill-editor {
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 6px;
            background-color: var(--md-sys-color-surface);
            padding: 0; /* 外層不要額外 padding，交給 .ql-editor */
            box-sizing: border-box;
        }

        .article-edit-form .form-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 30px;
            gap: 12px;
        }

        .material-button.secondary-btn {
            background-color: var(--md-sys-color-secondary);
            color: var(--md-sys-color-on-secondary);
        }

        .material-button.secondary-btn:hover {
            background-color: var(--md-sys-color-secondary-fixed-dim);
        }


        /* 真正的編輯區 */
        .quill-editor .ql-editor {
            min-height: 200px;
            padding: 12px;
            background-color: transparent;
            box-sizing: border-box;
        }

        /* 表單標題 */
        .form-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--md-sys-color-on-surface);
            margin-bottom: 24px;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            padding-bottom: 10px;
            text-align: center;
        }


    </style>
</head>
<body class="light">
<div class="app-container">
    <!--後台:側邊攔，通用樣式，不用改-->
    <div th:insert="~{/navBackTemplate :: navbar}"></div>

    <div class="main-content">
        <!--前台:頂部次導覽:各模組複製subnavXxx.html改好後，修正下面為subnav模組名 :: subnav('模板的要點亮的key')，-->
        <div th:insert="~{back-end/forum/subnavForum :: subnav('all')}"></div>

        <!--main 以下為頁面主要內容 -->
        <main class="content-area-main">
<!--            <h3><a class="navbar-brand" th:href="@{/forum/admin/selectPage}">前往文章查詢</a></h3>-->
            <h2 class="form-title">📝 編輯文章</h2>

            <!--    文章編輯表單      -->
            <form class="article-edit-form" th:action="@{/forum/admin/update}" method="post" th:object="${articleForm}" enctype="multipart/form-data">
                <!-- 文章編號 -->
                <div class="form-group half">
                    <label for="artId">文章編號</label>
                    <input id="artId" type="text" th:field="*{artId}" class="input-readonly" readonly />
                </div>

                <!-- 文章標題 -->
                <div class="form-group half">
                    <label for="artTitle">文章標題</label>
                    <input type="text" id="artTitle" th:field="*{artTitle}" required />
                    <span th:if="${#fields.hasErrors('artTitle')}" th:errors="*{artTitle}" class="error"
                          id="artTitle.errors"></span>
                </div>
                

                <!-- 文章類別 -->
                <div class="form-group">
                    <label for="artCat">文章類別</label>
                    <select id="artCat" th:field="*{artCat}" required>
                        <option value="1">文章</option>
                        <option value="2">問題</option>
                        <option value="3">已解決</option>
                    </select>
                </div>

                <!-- 會員編號（唯讀） -->
                <div class="form-group">
                    <label for="artHol">會員編號</label>
                    <input type="number" id="artHol" th:field="*{artHol}" class="input-readonly" readonly />
                    <span th:if="${#fields.hasErrors('artHol')}" th:errors="*{artHol}" class="error" id="artHol.errors"></span>
                </div>

                <!-- 上下架狀態 -->
                <div class="form-group">
                    <label for="artSta">狀態</label>
                    <select id="artSta" th:field="*{artSta}" required>
                        <option value="1">上架</option>
                        <option value="2">下架</option>
                        <option value="3">檢舉下架(待測試需不需要)</option>
                    </select>
                </div>

                <!-- 文章內容 -->
                <div class="form-group full-width">
                    <label for="editor">文章內容</label>
                    <textarea id="artCon" th:field="*{artCon}" style="display:none;"></textarea>
                    <div id="editor" class="quill-editor">
                        <div th:utext="*{artCon}"></div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="material-button secondary-btn" onclick="history.back()">取消</button>
                    <button type="submit" class="material-button">送出</button>
                </div>

            </form>

            <div id="editor2">
                <!--Qill編輯器-->
            </div>
            <!-- ===================================================================== -->

            <button onclick="getContent()">查看輸出內容</button>

            <pre id="output"></pre>


        </main>
    </div>
</div>

<script>
    // 隱藏錯誤訊息用
    function hideContent(d) {
        document.getElementById(d).style.display = "none";
    }

    // 表單送出時，把 Quill 的 HTML 內容填到隱藏的 textarea
    document.querySelector('form').addEventListener('submit', function (e) {
        const html = quill.root.innerHTML;
        document.querySelector('#artCon').value = html;
    });

    // 避免第一次載入時 Quill 是空的
    window.addEventListener('DOMContentLoaded', () => {
        const initialContent = document.querySelector('#artCon').value;
        quill.root.innerHTML = initialContent;
    });

</script>

<!-- 引用Quill編輯器-->
<script th:src="@{/vendors/quillEditor/quilljs.js}"></script>
<script>
    const quill = new Quill('#editor', {
        modules: {
            toolbar: [
                [{'size': ['small', false, 'large', 'huge']}, 'bold', 'italic', 'underline', 'strike', 'blockquote'],        // toggled buttons
                ['link', 'image', 'video'],

                [{'list': 'ordered'}, {'list': 'bullet'}, {'list': 'check'}],
                [{'direction': 'rtl'}],                         // text direction

                [{'header': [1, 2, 3, 4, 5, 6, false]}],

                [{'color': []}, {'background': []}],          // dropdown with defaults from theme
                [{'align': []}],

                ['clean']                                         // remove formatting button
            ],
        },
        placeholder: '來寫點什麼吧……',
        theme: 'snow', // or 'bubble'
    });


</script>

</body>
</html>